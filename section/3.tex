\chapter{基于动态物体分割的SLAM技术}
\label{sec:object_tracking}
基于动态物体分割的SLAM方法将场景中的特征对应聚类成不同类别，并跟踪它们的三维轨迹，将复杂动态场景拆解为一个一个刚体运动的子空间解耦求解。动态物体分割(也称为multi-body segmentation或eorumotion segmentation)将图像中的所有特征对应关系聚类成$n$个不同的运动类别。由于该问题是一个鸡生蛋、蛋生鸡的问题(chicken-egg problem)，因此求解较为困难。为估计动态物体的运动，应首先对特征进行聚类；另一方面，聚类特征需要知道所有运动物体的运动模型。由于遮挡、运动模糊和特征跟踪丢失而带来的噪声、异常值和特征对应缺失使问题变得更加复杂。另一个挑战是如何处理退化运动(如当物体与相机在相同平面上以相同方向和速度移动)或相关运动(例如两个人一起移动，关节运动)的场景。

\section{静态模型选择}
在静态场景中，可通过一个运动模型来描述相邻帧特征点的对应关系。相反，动态场景中的特征点可能来源于具有不同运动模型的物体。运动模型通常基于以下几种模型：基础矩阵($F$)，仿射基本矩阵($F_A$)，本质矩阵($E$)，单应性/投射($H$)或仿射($A$)矩阵。选择模型时，通常会尝试将所有可能的运动模型与数据拟合，并选择最适合数据的模型。如果数据可以由动态场景中的多个模型描述，则基于这些运动模型，需要建立许多假设才能进行动态物体的分割。

基于统计的3D动态物体分割方法会对数据的子集进行采样，并通过RANSAC~\cite{fischler1981randomA}或Monte-Carlo采样迭代~\cite{schindler2006two}用模型进行数据拟合。该类方法使用运动模型将数据划分为局内点(inlier，即符合该运动模型的数据)和局外点(outlier，不符合该运动模型的数据)。之后，对剩余的数据(即当前模型对应的局外点)再次采样，用新采样的数据拟合另一个运动模型，实现动静物体分割。该过程迭代重复，直到所有数据都可以由$n$个运动模型描述，或者剩余的异常值不足以产生更多的运动模型。迭代收敛后，该运动分割过程可从头开始，以生成许多候选的运动分割假设供后续选择。

目前，学者们已提出许多基于统计模型选择的方法来实现动态物体分割。Torr~\cite{faugeras1998geometric}对邻近的特征对应进行采样，并在RANSAC迭代下计算不同的运动模型($F, F_A, H, A$)。该方法用GRIC选择最能符合聚类局内点的运动模型。然而，当所选模型的局内点数量低于阈值时，则使用EM算法(expectation maximization)。为避免费时费力的暴力计算，Schindler和Suter~\cite{schindler2005two}~\cite{schindler2006two}提出了局部蒙特卡罗采样法，从图像上定义的子区域中进行采样。他们提出了一种从数据中估计噪声大小(noise scale)的方法，从而可以恢复每个运动的残差分布及其标准差。此外，他们推导出了一个新的似然函数，允许运动模型($F, H$)重叠，由GRIC选择最佳模型。

虽然之前的方法是对两个图像序列进行操作，但Schindler等人~\cite{schindler2006perspective}将~\cite{schindler2005two}中的技术扩展到一般运动模型(本质矩阵$E$)下的多视角图像。为了从多于两张图像的序列中将若干被选的本质矩阵关联起来，他们通过仅连接那些具有相似内点集的基本矩阵，来加强时间一致性。最后，使用类似MDL的方法来选择描述运动的最佳模型。这种方法已被Schindler等人泛化为适用于任何相机模型(不仅是投影相机)和运动模型(不仅是基本矩阵$E$)的动态物体分割方法~\cite{schindler2008model}。另外，Ozden等人也考虑了许多实际因素~\cite{ozden2010multibody}，他们研究了如何将之前识别出的动态物体与静态背景融合，或如何将聚类分成两类不同运动模式的问题。

Thakoor等人~\cite{thakoor2010multibody}将模型选择描述为组合优化问题。采用branch-and-bound技术，通过将优化问题分解为较小的子问题，使用AIC作为代价函数来优化运动分割。对对应关系的局部采样也用于生成运动模式，而空假设(null hypothesis)用于处理局外点。最近，Sabzevari和Scaramuzza~\cite{sabzevari2014monocular}利用了基于投影轨迹矩阵分解的统计模型选择技术，通过对极几何生成运动模型，用重投影误差剔除不合理的假设。通过一次次迭代时不断优化结构估计和运动分割估计后，评估当前假设的合理性。该方法已在~\cite{sabzevari2016multiA}中得到拓展，通过施加相机位姿约束，相机和动态物体的位姿可以分别用单点法(one-point algorithm)~\cite{scaramuzza20111A}~\cite{scaramuzza2009realA}和两点法(two-point algorithm)~\cite{ortin2001indoor}求得。

\section{子空间聚类}
子空间聚类是基于以下观察而被提出的：许多高维数据可以由低维子空间的并集来表示。数据点的子空间可以表示成基向量和数据的低维表示。子空间聚类框架下的三维运动分割问题基本可描述为找到与每个物体运动相关的子空间，并将数据拟合到子空间中。然而，由于在实际中子空间和数据分割是未知的，因此只能同时进行子空间参数估计和数据的子空间聚类。Costeira-Kanade~\cite{costeira1998multibody}和Gear~\cite{gear1998multibody}通过观察发现独立的刚体运动位于线性子空间中，从而首次提出了用子空间聚类进行运动分割的方法。通过施加秩(rank)的约束，可以恢复每一个线性子空间。

Kanatani~\cite{kanatani2001motionA}提出“子空间分离”的概念，将其作为聚类低维子空间的一般方法(不仅限于运动分割)，借用统计模型选择实现子空间分离。该方法通过平衡在拟合数据点到子空间时残差的增加及子空间合并时自由度的减小，来选择最佳的子空间划分，并使用最小平方中值(least median of squares)法拟合带有局外点的数据。不同的是，Vidal等人~\cite{vidal2005generalized}扩展了主成分分析(principal component analysis)的概念，提出广义主成分分析(generalized principal component analysis, GPCA)法。PCA仅适用于数据都位于同一线性子空间内的情况，而GPCA可适用于数据位于多个线性子空间的情况。GPCA通过多项式嵌入(或Veronese映射)用$n$阶齐次多项式拟合数据，并通过计算特定点处多项式的导数找到每个子空间的法线，以解决寻找子空间的问题。然后，通过从法向量之间的角度计算相似性矩阵，使用谱聚类进行分割。为了在分割中考虑实际情况，在聚类前，该方法将数据投影到较低维空间中~\cite{vidal2005generalized}，然后通过找到多项式嵌入的秩来计算运动模式的数量$n$。

由于之前的算法假设运动是刚性的，与实际情况还有一定差距，因此Yan和Pollefeys~\cite{yan2006general}提出了一个称为局部子空间仿射(local subspace affinity, LSA)的通用框架，可用于独立、铰接、刚性、非刚性、退化以及非退化的运动模式。LSA通过对点及其最近邻的区域进行采样，用局部子空间拟合采样数据，来估计子空间。最近邻的点可通过计算矢量之间的角度或距离得到。然后，通过计算两个局部子空间的夹角求解仿射矩阵，并对仿射矩阵进行谱聚类得到聚类结果。在估计子空间之前，还要将数据向低维子空间投影。与LSA类似，Goh和Vidal~\cite{goh2007segmenting}也用一个点及其最近邻点拟合局部子空间。基于局部线性嵌入法(locally linear embedding, LLE)~\cite{saul2003think}，学者们提出了局部线性流形聚类法(locally linear manifold clustering, LLMC)。该方法使用LLE将数据转换为低维表示，并计算由LLE生成矩阵的零空间(null space)来将与每个运动相关联的分离的流形进行聚类，而其中数据的分离可由零空间中的向量表示。

Elhamifar和Vidal~\cite{elhamifar2009sparse}~\cite{elhamifar2013sparse}给出了另一种观点，它利用稀疏表示将运动模式进行聚类。他们发现线性或仿射子空间的并集中的点可以表示为子空间中所有数据点的线性或仿射组合，并提出了稀疏子空间聚类法(sparse subspace clustering, SSC)。然而，只有当点可被表示为同一子空间中数据的线性或仿射组合时，才能获得稀疏表示。在无噪声数据下，可以通过求解$L_1$最小化问题来估计稀疏系数。给定稀疏系数，可以构建仿射矩阵，通过谱聚类来完成聚类。Rao等人开发了SSC的扩展方法~\cite{rao2009motion}，它们融合了稀疏表示和数据压缩以处理实际问题，例如数据丢失，不完整或包含局外点。最近，Yang等人~\cite{yang2015sparse}提出了矩阵补全技术来改进SSC算法。与稀疏表示相反，Liu~\cite{liu2012robust}和Chen等人~\cite{liu2010robust}采用低秩表示(low rank representation, LRR)，使用谱聚类来定义仿射矩阵，实现子空间分割。

值得注意的是，大多数子空间聚类技术以批(batch)处理的形式进行。Vidal~\cite{vidal2007online}设计了一种迭代聚类技术，适用于位于多个移动超平面中的数据。该方法用一组时变多项式模拟了一组移动超平面，利用梯度下降，通过估计超平面的归一化法向量来递归地完成分割。Zhang等人提出了在线子空间聚类的另一种实现方式~\cite{zhang2009median}。他们修改了K-flats算法，使其能够增量地获取输入数据。他们将$L_1$用作目标函数(而非$L_2$)，以便在数据包含噪声和局外点的情况下增强算法的鲁棒性。

在过去的几十年中，子空间聚类已经成为被广泛研究的课题，并且出现了许多方法。有关子空间聚类更详细的介绍，可阅读文献~\cite{vidal2011subspace}。

\section{动态物体的3D跟踪}
在实际应用中，跟踪三维空间中的动态物体并估计其三维坐标和深度具有非常重要的意义。该问题的挑战在于，一般的视觉SLAM系统假设场景是刚性、完全静止的，并用三角化方法~\cite{hartley1997triangulation}估计场景的三维结构，但该方法并不适用于动态物体，因为特征点重投影之后并不重合。假设$x_1$和$x_2$分别为第一帧和第二张帧图像中对应的特征点，则它们对应的3D点$X$的坐标应该能通过经相机投影矩阵$P_1$和$P_2$，计算$x_1$和$x_2$重投影光线的交点得到。但是，由于动态物体的运动和相机不同，因此从第一帧到第二帧重投影的光线也在移动，因此二者不相交。为解决动态物体的3D跟踪问题，需要其他的技术作为辅助。本节主要讨论估计动态物体的3D轨迹的相关工作。

由前面的论述可知，标准的三角化测量~\cite{hartley1997triangulation}不能用于重建动态物体的3D结构，因为重投影的光线不相交。Avidan和Shashua~\cite{avidan1999trajectory}~\cite{avidan2000trajectory}提出了轨迹三角化测量方法，可在目标轨迹已知或满足某种参数形式的前提下，重建动态物体的三维点云。该方法假设3D点沿着三维空间中一条未知的直线运动，于是该问题就变成了寻找一条直线，与$t$个视角的投影光线都相交的问题。在$t$至少为5时，该问题有唯一解。因为3个视角的投影光线交叉将形成二次曲面，第4个视角的投影光线与该二次曲面交于2点，此时而第5个视角的投影光线便可使交点唯一确定。

与之相反，Shashua等人~\cite{shashua1999trajectory}假设物体在圆锥截面上移动。在这种假设下，需要至少9个视角才能获得唯一解。如果已知圆锥曲线的类型（圆、椭圆等），则只需要至少7个视角即可。他们通过将圆锥方程拟合二维空间中的运动点，或通过最小化三维空间中估计圆锥半径的误差来解决该非线性优化问题。基于之前的相关工作，Kaminski和Teicher~\cite{kaminski2002general}~\cite{kaminski2004general}将轨迹三角化问题泛化为在投影空间中找到一个超曲面簇。这种多项式的表示形式将非线性轨迹估计问题转化为未知参数空间中的线性问题。另一方面，为了处理缺失的数据，Park等人~\cite{park20103d}将3D轨迹表示为轨迹基矢量的线性组合，这样就可以用最小二乘法鲁棒地估计三维点云的位置。他们还通过分析相机运动、图像点运动和轨迹基矢量之间的关系，提出了可重构性标准(reconstructability criteria)。由于可重构性与3D重建误差成反比，因此该标准可以准确地考察精确重建的可能性~\cite{park20153d}。

由于可观测性问题（观察者与目标之间的距离无法观测得到），单目相机进行动态物体的3D跟踪可被视为仅可跟踪(bearing-only-tracking,BOT)问题。单目相机可以被视为一种BOT传感器，它只能提供动态物体上被跟踪特征点的方向信息（例如上一帧和当前帧中对应的特征相对相机中心的角度）。对于BOT问题，往往使用基于滤波的方法，因为它可建模相机和目标的位置和速度的不确定性，并且已得到广泛的研究~\cite{aidala1983utilization}~\cite{le1998bearings}。

Kundu等人~\cite{kundu2011realtime}采用粒子滤波器来估计动态物体的位置和速度，他们用瞬时匀速运动模型(instantaneous constant velocity motion model)建模未知运动，并用李代数(Lie algebra)参数化动态物体的刚体变换。在初始化时，用几何约束和流向量绑定(flow vector bound)对动态物体进行分割~\cite{kundu2009movingA}~\cite{kundu2010realtime}，并且使粒子沿投影光线均匀分布。利用由静态场景的三维点云估计得到的地平面和允许的最大深度值来约束粒子的空间。之后，将每个粒子投影到当前帧，计算重投影误差(投影点和实际特征点位置的误差)来更新每个粒子的权重。由于较低误差或较高权重的粒子具有较高的重采样概率，因此它们集中于能够产生最小重投影误差的深度值周围。